<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="format-detection" content="telephone=no">
    <title>æ°¸åŠ«æ— é—´æˆ˜ç»©æŸ¥è¯¢</title>
    
    <!-- é¢„åŠ è½½å…³é”®å­—ä½“ -->
    <link rel="preconnect" href="https://unpkg.com">
    
    <!-- å¤–éƒ¨ä¾èµ– -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js" onerror="console.error('VueåŠ è½½å¤±è´¥')"></script>
    <script src="https://unpkg.com/element-plus/dist/index.full.js" onerror="console.error('ElementPlusåŠ è½½å¤±è´¥')"></script>
    <script src="https://unpkg.com/@element-plus/icons-vue/dist/index.iife.js" onerror="console.error('å›¾æ ‡åº“åŠ è½½å¤±è´¥')"></script>
    <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css" onerror="console.error('ElementPlusæ ·å¼åŠ è½½å¤±è´¥')" />
    
    <!-- æœ¬åœ°æ ·å¼æ–‡ä»¶ -->
    <link rel="stylesheet" href="styles.css" />
</head>
<body>
    <div id="app">
        <div class="app-container">
            <!-- æ ‡é¢˜ -->
            <el-card class="header-card" shadow="hover">
                <h1 class="header-title">æ°¸åŠ«æ— é—´æˆ˜ç»©æŸ¥è¯¢</h1>
                <p style="color: #606266;">è¾“å…¥æ¸¸æˆè§’è‰²åç§°æŸ¥è¯¢æ’ä½æˆ˜ç»©ä¿¡æ¯</p>
            </el-card>

            <!-- æœç´¢åŒºåŸŸ -->
            <el-card class="search-card" shadow="hover">
                <div class="search-form">
                    <el-input
                        v-model="playerName"
                        placeholder="è¯·è¾“å…¥ç©å®¶åç§°..."
                        class="search-input"
                        size="large"
                        @keyup.enter="searchPlayer"
                        :disabled="loading"
                        clearable
                    >
                        <template #prefix>
                            <el-icon><User /></el-icon>
                        </template>
                    </el-input>
                    <el-button
                        type="primary"
                        size="large"
                        @click="searchPlayer"
                        :loading="loading"
                        :disabled="!playerName.trim()"
                    >
                        <el-icon><Search /></el-icon>
                        æŸ¥è¯¢æˆ˜ç»©
                    </el-button>
                </div>
            </el-card>

            <!-- ç©å®¶åŸºæœ¬ä¿¡æ¯ -->
            <el-card 
                v-if="apiResponse && apiResponse.player_data" 
                class="player-info-card" 
                shadow="hover"
            >
                <template #header>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <el-icon color="#409eff"><Avatar /></el-icon>
                        <span style="font-weight: bold;">ç©å®¶ä¿¡æ¯</span>
                    </div>
                </template>
                
                <!-- ç©å®¶å¤´åƒå’ŒåŸºæœ¬ä¿¡æ¯ -->
                <div class="player-header" v-if="apiResponse.basic_stats && apiResponse.basic_stats.data && apiResponse.basic_stats.data.role">
                    <img 
                        v-if="apiResponse.basic_stats.data.role.head_icon"
                        :src="apiResponse.basic_stats.data.role.head_icon" 
                        :alt="apiResponse.basic_stats.data.role.role_name"
                        class="player-avatar"
                        @error="handleImageError"
                    />
                    <div v-else class="default-avatar">ğŸ‘¤</div>
                    <div class="player-basic">
                        <div class="player-name">{{ apiResponse.basic_stats.data.role.role_name }}</div>
                        <div class="player-level">Lv.{{ apiResponse.basic_stats.data.role.role_level }}</div>
                    </div>
                </div>
                
                <div class="info-grid">
                    <div class="info-item">
                        <span class="info-label">è§’è‰²ID</span>
                        <span class="info-value">{{ extractRoleId(apiResponse.player_data.data.role_id) }}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">æœåŠ¡å™¨</span>
                        <span class="info-value">{{ apiResponse.player_data.data.server_name }}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">æ¸¸æˆæ—¶é•¿</span>
                        <span class="info-value">{{ formatGameTime(apiResponse.player_data.data.game_time) }}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">æ›´æ–°æ—¶é—´</span>
                        <span class="info-value">{{ apiResponse.player_data.data.update_time }}</span>
                    </div>
                </div>
            </el-card>

            <!-- æ’ä½æˆ˜ç»©ç»Ÿè®¡ -->
            <el-card 
                v-if="apiResponse && apiResponse.detailed_stats && Object.keys(apiResponse.detailed_stats).length > 0" 
                class="detailed-stats-section" 
                shadow="hover"
            >
                <template #header>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <el-icon color="#409eff"><Trophy /></el-icon>
                        <span style="font-weight: bold;">æ’ä½æˆ˜ç»©ç»Ÿè®¡</span>
                    </div>
                </template>
                
                <el-tabs v-model="activeTab" class="mode-tabs" @tab-change="onTabChange">
                    <el-tab-pane 
                        v-for="(modeResponse, modeName) in apiResponse.detailed_stats" 
                        :key="modeName"
                        :label="modeName" 
                        :name="modeName"
                    >
                        <div v-if="modeResponse && modeResponse.code === 0 && modeResponse.data">
                            <!-- æ®µä½å±•ç¤º -->
                            <div v-if="modeResponse.data.grade" class="grade-display">
                                <img 
                                    v-if="modeResponse.data.grade.grade_icon"
                                    :src="modeResponse.data.grade.grade_icon" 
                                    :alt="modeResponse.data.grade.grade_name"
                                    class="grade-icon"
                                    @error="handleImageError"
                                />
                                <div v-else class="grade-icon" style="background: rgba(255,255,255,0.2); display: flex; align-items: center; justify-content: center; font-size: 24px;">ğŸ†</div>
                                <div class="grade-info">
                                    <div class="grade-name">
                                        {{ getFullGradeName(modeResponse.data.grade) }}
                                    </div>
                                    <div class="grade-score">
                                        {{ modeResponse.data.grade.grade_score || 0 }} / {{ modeResponse.data.grade.grade_threshold || 0 }} åˆ†
                                    </div>
                                </div>
                                <div v-if="modeResponse.data.dragon_kill" class="dragon-kill">
                                    <div class="dragon-kill-number">ğŸ‰ {{ modeResponse.data.dragon_kill }}</div>
                                    <div>é¾™æ€æ•°</div>
                                </div>
                            </div>
                            
                            <!-- ç»Ÿè®¡æ•°æ® - ä½¿ç”¨APIè¿”å›çš„statsæ•°ç»„ -->
                            <div v-if="modeResponse.data.stats && modeResponse.data.stats.length > 0" class="stats-grid">
                                <div 
                                    v-for="stat in modeResponse.data.stats" 
                                    :key="stat.key"
                                    class="stat-card"
                                >
                                    <div class="stat-value">{{ stat.value }}</div>
                                    <div class="stat-name">{{ stat.name }}</div>
                                </div>
                            </div>
                        </div>
                        <div v-else>
                            <el-alert
                                title="è¯¥æ¨¡å¼æš‚æ— æ•°æ®"
                                type="info"
                                :closable="false"
                            />
                        </div>
                    </el-tab-pane>
                </el-tabs>
            </el-card>

            <!-- æœ€è¿‘å¯¹å±€è®°å½• -->
            <el-card 
                v-if="currentBattles && currentBattles.code === 0 && currentBattles.data && currentBattles.data.list && currentBattles.data.list.length > 0" 
                class="recent-battles-section" 
                shadow="hover"
                style="margin-bottom: 20px;"
            >
                <template #header>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <el-icon color="#409eff"><List /></el-icon>
                        <span style="font-weight: bold;">{{ activeTab }} - æœ€è¿‘å¯¹å±€è®°å½•</span>
                    </div>
                </template>
                
                <div class="battles-list">
                    <div 
                        v-for="(battle, index) in currentBattles.data.list" 
                        :key="battle.battle_id"
                        class="battle-item"
                    >
                        <div class="battle-rank" :class="getRankClass(battle.rank)">
                            #{{ battle.rank }}
                        </div>
                        
                        <div class="battle-hero">
                            <img 
                                :src="battle.hero.hero_icon" 
                                :alt="battle.hero.hero_name"
                                class="hero-icon"
                                @error="handleImageError"
                            />
                            <span class="hero-name">{{ battle.hero.hero_name }}</span>
                        </div>
                        
                        <div class="battle-mode">
                            {{ getModeText(battle.subtype) }}
                        </div>
                        
                        <div class="battle-stats">
                            <div class="stat-item">
                                <span class="stat-label">å‡»è´¥</span>
                                <span class="stat-value">{{ battle.kill }}</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">ä¼¤å®³</span>
                                <span class="stat-value">{{ battle.damage }}</span>
                            </div>
                        </div>
                        
                        <div class="battle-score">
                            <div class="score-change" :class="getScoreChangeClass(battle.begin_rank_score, battle.round_rank_score)">
                                {{ getScoreChange(battle.begin_rank_score, battle.round_rank_score) }}
                            </div>
                            <div class="final-score">{{ battle.round_rank_score }}</div>
                        </div>
                        
                        <div class="battle-rating" :class="'rating-' + battle.rating.toLowerCase()">
                            {{ battle.rating }}
                        </div>
                        
                        <div class="battle-time">
                            {{ formatBattleTime(battle.battle_end_time) }}
                        </div>
                    </div>
                </div>
            </el-card>

            <!-- å½“å‰æ¨¡å¼æ— å¯¹å±€è®°å½•æ—¶çš„æç¤º -->
            <el-card 
                v-else-if="apiResponse && apiResponse.detailed_stats && Object.keys(apiResponse.detailed_stats).length > 0"
                class="recent-battles-section" 
                shadow="hover"
                style="margin-bottom: 20px;"
            >
                <template #header>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <el-icon color="#409eff"><List /></el-icon>
                        <span style="font-weight: bold;">{{ activeTab }} - æœ€è¿‘å¯¹å±€è®°å½•</span>
                    </div>
                </template>
                
                <el-alert
                    :title="`${activeTab} æš‚æ— å¯¹å±€è®°å½•`"
                    type="info"
                    :closable="false"
                    style="margin: 20px 0;"
                />
            </el-card>

            <!-- é”™è¯¯æç¤º -->
            <el-alert
                v-if="errorMessage"
                :title="errorMessage"
                type="error"
                :closable="false"
                style="margin-top: 20px;"
            />
        </div>
    </div>

    <!-- æœ¬åœ° JavaScript æ–‡ä»¶ -->
    <script src="app.js"></script>
</body>
</html>
